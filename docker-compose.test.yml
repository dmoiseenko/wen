version: '2'

services:
  selenium:
    image: selenium/standalone-chrome-debug
    links:
      - nginx

  api:
    build:
      context: .
      dockerfile: ./dockerfiles/prod/Dockerfile
    env_file: .env.prod
    command: npm run api

  static:
    build:
      context: .
      dockerfile: ./dockerfiles/prod/Dockerfile
    env_file: .env.prod
    command: npm run static

  socket:
    build:
      context: .
      dockerfile: ./dockerfiles/prod/Dockerfile
    env_file: .env.prod
    command: npm run socket

  runner:
    build:
      context: .
      dockerfile: ./dockerfiles/prod/Dockerfile
    env_file: .env.prod
    command: npm run bootstrap
    links:
      - selenium

  nginx:
    ports:
      - '3000:3000'

  postgres:
    env_file: .env.prod
