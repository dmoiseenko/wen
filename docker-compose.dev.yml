version: '2'

services:
  selenium:
    image: selenium/standalone-chrome-debug:3.4.0
    ports:
      - '5900:5900'
    links:
      - nginx:wen.com

  api:
    build:
      context: .
      dockerfile: ./dockerfiles/dev/Dockerfile
    volumes:
      - ./client:/usr/src/app/client/:ro
      - ./common:/usr/src/app/common/:ro
      - ./scripts:/usr/src/app/scripts/:ro
      - ./server:/usr/src/app/server/:ro
      - ./static:/usr/src/app/static/:ro
      - ./e2e:/usr/src/app/e2e/:ro
      - ./chimp.js:/usr/src/app/chimp.js:ro
      - ./package.json:/usr/src/app/package.json:ro
      - ./jest.unit.json:/usr/src/app/jest.unit.json:ro
      - ./jest.integration.json:/usr/src/app/jest.integration.json:ro
      - ./.babelrc:/usr/src/app/.babelrc:ro
      - ./.eslintrc:/usr/src/app/.eslintrc:ro
      - ./.eslintignore:/usr/src/app/.eslintignore:ro
    env_file: .env.dev
    command: npm run watch:api

  static:
    build:
      context: .
      dockerfile: ./dockerfiles/dev/Dockerfile
    volumes_from:
      - api
    env_file: .env.dev
    command: npm run watch:static

  socket:
    build:
      context: .
      dockerfile: ./dockerfiles/dev/Dockerfile
    volumes_from:
      - api
    env_file: .env.dev
    command: npm run watch:socket

  nginx:
    ports:
      - '3000:3000'

  runner:
    build:
      context: .
      dockerfile: ./dockerfiles/dev/Dockerfile
    volumes_from:
      - api
    env_file: .env.dev
    links:
      - selenium
    command: /bin/true

  postgres:
    env_file: .env.dev
    ports:
      - '5432:5432'
